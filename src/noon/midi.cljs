(ns noon.midi
  "WIP, many features are missing compared to clj version"
  (:require [clojure.string :as str]
            ["tone" :as Tone]
            ["smplr" :refer [Soundfont]]
            [noon.data.GM :as gm]))

;; https://github.com/alda-lang/alda-sound-engine-clj/blob/master/src/alda/sound/midi.clj

(def DEFAULT_EVENT
  {:position 0
   :channel 0
   :track 0})

(def DEFAULT_NOTE
  (merge DEFAULT_EVENT
         {:duration 1
          :pitch 60
          :velocity 80}))

(def MIDI_RESOLUTION 2048)

(do :control-changes

    ;; https://anotherproducer.com/online-tools-for-musicians/midi-cc-list/
    ;; most commons control changes message codes
    (def MIDI-CC
      {0 "Bank Select 1"
       1 "Modulation Wheel"
       2 "Breath controller"
       4 "Foot Pedal"
       5 "Portamento Time"
       6 "Data Entry"
       7 "Volume"
       8 "Balance"
       10 "Pan position"
       11 "Expression"
       12 "Effect Control 1"
       13 "Effect Control 2"
       32 "Bank Select 2"
       64 "Hold Pedal"
       65 "Portamento"
       66 "Sostenuto Pedal"
       67 "Soft Pedal"
       68 "Legato Pedal"
       69 "Hold 2 Pedal"
       70 "Sound Variation"
       71 "Resonance"
       72 "Sound Release Time"
       73 "Sound Attack Time"
       74 "Frequency Cutoff"})

    (defn cc-name->keyword [name]
      (-> (str/lower-case name)
          (str/replace #" " "-")
          (keyword)))

    (def CONTROL_CHANGES
      (map (fn [[code name]]
             {:code code
              :name name
              :key (cc-name->keyword name)})
           MIDI-CC))

    (defn cc-code [x]
      (if (int? x)
        x
        (-> (filter (fn [{:keys [name key]}]
                      (or (= x key)
                          (= (str/lower-case x) (str/lower-case name))))
                    CONTROL_CHANGES)
            first :code)))

    (comment :tries

             (cc-code :bank-select)
             (cc-code :expression)
             (cc-code "resonance")
             (cc-code "Resonance")))

(do :midi

    #_(.resume (new js/AudioContext))

    ;; when playing some midi we get back a stop function,
    ;; all those functions are kept here in order to be able to stop all playing instruments.
    (def stop-fns* (atom []))

    (defn get-instrument [instrument-name]
      (.-load (Soundfont. (.-_context (.-context Tone))
                          #js {:instrument instrument-name #_:kit #_"FluidR3_GM"})))

    (defn stop-midi []
      (println "stopping midi")
      #_(.stop Tone/Transport (.now Tone))
      (doseq [f @stop-fns*] (f)))

    (defn play [noon-data]
      #_(println "playing js " noon-data)
      #_(js/console.log Tone)
      (let [patch->events (group-by :patch noon-data)]
        (.then (js/Promise.all
                (mapv (fn [[[_bank instrument] events]]
                        (let [instrument-name (gm/instrument-val->instrument-name instrument)]
                          #_(log "loading: " instrument-name)
                          (.then (get-instrument instrument-name)
                                 (fn [inst] [inst events]))))
                      patch->events))

               (fn [xs]
                 #_(js/console.log "instruments " xs)
                 (let [t0 (.now Tone)]
                   (mapv (fn [[instrument events]]
                           (doseq [{:as _note :keys [channel pitch velocity duration position]} events]
                             (.start instrument
                                     #js {:channel channel
                                          :note pitch
                                          :velocity velocity
                                          :duration duration
                                          :time (+ t0 position)})))
                         xs)
                   {:stop (fn [] (doseq [[_ i] xs] (.stop i)))
                    :started (.start Tone/Transport)})))))

    (comment (def simple-tup
               [{:patch [0 4] :channel 0, :pitch 67, :voice 0, :duration (/ 1 3)  , :position (/ 2 3) , :velocity 80, :track 0}
                {:patch [0 6] :channel 0, :pitch 64, :voice 0, :duration (/ 1 3)  , :position (/ 1 3)  , :velocity 80, :track 0}
                {:patch [0 4], :channel 0, :pitch 60, :voice 0, :duration (/ 1 3), :position 0N, :velocity 80, :track 0}])

             (play-noon simple-tup)

             (def multi-chan
               [{:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 28.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 0.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 71, :voice 0, :duration 0.16666667, :position 9.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 68, :voice 0, :duration 0.16666667, :position 24.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 16.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 50, :voice 0, :duration 0.16666667, :position 30.333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 53, :voice 0, :duration 0.16666667, :position 17.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 56, :voice 0, :duration 0.16666667, :position 28.333334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 56, :voice 0, :duration 1.0, :position 4.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 16.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 23.833334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 65, :voice 0, :duration 1.0, :position 17.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 71, :voice 0, :duration 0.16666667, :position 9.666667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 29.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 53, :voice 0, :duration 0.16666667, :position 17.666666, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 62, :voice 0, :duration 1.0, :position 22.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 5.8333335, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 66, :voice 0, :duration 0.16666667, :position 13.333333, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 79, :voice 0, :duration 1.0, :position 10.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 72, :voice 0, :duration 0.16666667, :position 13.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 29, :voice 0, :duration 1.0, :position 20.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 15.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 16.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 8.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 25.333334, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 30, :voice 0, :duration 1.0, :position 21.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 52, :voice 0, :duration 0.16666667, :position 31.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 15.166667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 16.833334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 63, :voice 0, :duration 1.0, :position 8.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 66, :voice 0, :duration 0.16666667, :position 5.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 5.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 28.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 19.333334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 71, :voice 0, :duration 1.0, :position 23.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 0.33333334, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 35, :voice 0, :duration 1.0, :position 15.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 36, :voice 0, :duration 1.0, :position 16.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 35, :voice 0, :duration 1.0, :position 23.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 23, :voice 0, :duration 1.0, :position 31.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 6.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 3.8333333, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 66, :voice 0, :duration 1.0, :position 5.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 67, :voice 0, :duration 1.0, :position 30.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 77, :voice 0, :duration 1.0, :position 12.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 66, :voice 0, :duration 0.16666667, :position 11.166667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 18.833334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 16.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 23.333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 52, :voice 0, :duration 0.16666667, :position 27.333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 70, :voice 0, :duration 0.16666667, :position 11.833333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 20.833334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 23.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 64, :voice 0, :duration 0.16666667, :position 19.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 68, :voice 0, :duration 1.0, :position 12.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 55, :voice 0, :duration 1.0, :position 24.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 25.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 10.666667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 53, :voice 0, :duration 0.16666667, :position 28.833334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 20.5, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 10.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 22.833334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 56, :voice 0, :duration 0.16666667, :position 5.1666665, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 22.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 18.333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 68, :voice 0, :duration 0.16666667, :position 18.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 57, :voice 0, :duration 0.16666667, :position 21.833334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 75, :voice 0, :duration 1.0, :position 2.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 31.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 56, :voice 0, :duration 0.16666667, :position 4.3333335, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 57, :voice 0, :duration 0.16666667, :position 21.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 27.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 64, :voice 0, :duration 0.16666667, :position 19.666666, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 74, :voice 0, :duration 1.0, :position 1.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 23.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 9.5, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 58, :voice 0, :duration 1.0, :position 3.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 53, :voice 0, :duration 1.0, :position 25.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 22.333334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 74, :voice 0, :duration 1.0, :position 17.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 40, :voice 0, :duration 1.0, :position 19.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 1.6666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 8.333333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 54, :voice 0, :duration 0.16666667, :position 29.333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 19.833334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 25.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 13.166667, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 30.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 2.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 24.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 71, :voice 0, :duration 1.0, :position 25.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 16.333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 26.666666, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 63, :voice 0, :duration 1.0, :position 26.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 6.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 53, :voice 0, :duration 0.16666667, :position 29.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 30.833334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 76, :voice 0, :duration 0.16666667, :position 11.666667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 49, :voice 0, :duration 0.16666667, :position 30.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 3.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 3.1666667, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 62, :voice 0, :duration 1.0, :position 7.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 71, :voice 0, :duration 1.0, :position 7.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 67, :voice 0, :duration 1.0, :position 0.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 22.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 75, :voice 0, :duration 1.0, :position 18.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 69, :voice 0, :duration 1.0, :position 29.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 18.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 1.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 30.5, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 67, :voice 0, :duration 1.0, :position 14.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 24.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 28, :voice 0, :duration 1.0, :position 27.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 17.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 22.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 14.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 10.833333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 27.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 62, :voice 0, :duration 1.0, :position 25.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 67, :voice 0, :duration 1.0, :position 19.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 59, :voice 0, :duration 1.0, :position 15.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 40, :voice 0, :duration 1.0, :position 3.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 35, :voice 0, :duration 1.0, :position 1.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 6.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 7.1666665, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 68, :voice 0, :duration 1.0, :position 28.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 29, :voice 0, :duration 1.0, :position 4.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 64, :voice 0, :duration 1.0, :position 11.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 40, :voice 0, :duration 1.0, :position 11.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 62, :voice 0, :duration 1.0, :position 23.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 35, :voice 0, :duration 1.0, :position 7.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 25.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 76, :voice 0, :duration 0.16666667, :position 11.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 67, :voice 0, :duration 1.0, :position 18.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 61, :voice 0, :duration 0.16666667, :position 9.166667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 11.333333, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 36, :voice 0, :duration 1.0, :position 18.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 17.833334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 76, :voice 0, :duration 1.0, :position 3.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 1.1666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 0.6666667, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 65, :voice 0, :duration 1.0, :position 20.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 66, :voice 0, :duration 0.16666667, :position 5.6666665, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 8.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 67, :voice 0, :duration 1.0, :position 3.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 26.833334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 66, :voice 0, :duration 1.0, :position 21.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 26.5, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 30, :voice 0, :duration 1.0, :position 29.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 35, :voice 0, :duration 1.0, :position 17.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 22.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 79, :voice 0, :duration 1.0, :position 8.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 12.166667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 24.833334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 64, :voice 0, :duration 0.16666667, :position 3.3333333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 18.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 70, :voice 0, :duration 1.0, :position 27.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 22.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 6.8333335, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 65, :voice 0, :duration 1.0, :position 4.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 53, :voice 0, :duration 1.0, :position 7.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 53, :voice 0, :duration 0.16666667, :position 28.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 4.8333335, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 12.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 10.166667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 14.833333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 48, :voice 0, :duration 0.16666667, :position 28.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 54, :voice 0, :duration 0.16666667, :position 19.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 54, :voice 0, :duration 0.16666667, :position 21.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 18.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 59, :voice 0, :duration 1.0, :position 17.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 8.666667, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 29, :voice 0, :duration 1.0, :position 28.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 25.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 10.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 2.8333333, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 57, :voice 0, :duration 1.0, :position 5.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 56, :voice 0, :duration 1.0, :position 20.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 21.333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 20.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 27.666666, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 2.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 58, :voice 0, :duration 1.0, :position 19.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 0.8333333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 0.5, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 50, :voice 0, :duration 1.0, :position 31.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 70, :voice 0, :duration 1.0, :position 11.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 1.3333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 4.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 74, :voice 0, :duration 1.0, :position 14.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 12.833333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 17.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 1.5, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 55, :voice 0, :duration 1.0, :position 27.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 55, :voice 0, :duration 1.0, :position 26.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 0.16666667, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 62, :voice 0, :duration 1.0, :position 9.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 59, :voice 0, :duration 1.0, :position 1.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 77, :voice 0, :duration 1.0, :position 9.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 72, :voice 0, :duration 0.16666667, :position 13.666667, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 41, :voice 0, :duration 1.0, :position 12.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 36, :voice 0, :duration 1.0, :position 10.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 74, :voice 0, :duration 1.0, :position 15.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 67, :voice 0, :duration 1.0, :position 16.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 35, :voice 0, :duration 1.0, :position 25.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 79, :voice 0, :duration 1.0, :position 11.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 2.6666667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 57, :voice 0, :duration 0.16666667, :position 29.833334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 63, :voice 0, :duration 1.0, :position 24.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 48, :voice 0, :duration 0.16666667, :position 28.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 26.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 20.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 14.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 69, :voice 0, :duration 0.16666667, :position 13.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 4.1666665, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 57, :voice 0, :duration 0.16666667, :position 5.3333335, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 27.833334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 58, :voice 0, :duration 0.16666667, :position 19.5, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 65, :voice 0, :duration 1.0, :position 31.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 2.3333333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 23.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 6.3333335, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 54, :voice 0, :duration 0.16666667, :position 21.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 74, :voice 0, :duration 0.16666667, :position 14.166667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 29.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 72, :voice 0, :duration 0.16666667, :position 14.333333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 56, :voice 0, :duration 0.16666667, :position 12.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 10.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 15.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 31, :voice 0, :duration 1.0, :position 6.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 57, :voice 0, :duration 1.0, :position 21.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 7.3333335, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 31.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 65, :voice 0, :duration 1.0, :position 15.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 67, :voice 0, :duration 1.0, :position 2.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 51, :voice 0, :duration 0.16666667, :position 27.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 53, :voice 0, :duration 0.16666667, :position 31.333334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 13.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 7.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 53, :voice 0, :duration 1.0, :position 28.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 78, :voice 0, :duration 1.0, :position 13.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 10.333333, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 59, :voice 0, :duration 1.0, :position 31.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 54, :voice 0, :duration 1.0, :position 29.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 26.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 56, :voice 0, :duration 0.16666667, :position 20.333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 50, :voice 0, :duration 0.16666667, :position 26.166666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 56, :voice 0, :duration 0.16666667, :position 12.666667, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 8.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 24.333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 16.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 2.1666667, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 76, :voice 0, :duration 1.0, :position 19.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 67, :voice 0, :duration 0.16666667, :position 0.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 24.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 8.833333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 9.333333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 25.833334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 21.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 7.8333335, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 20.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 20.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 9.833333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 2.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 1.8333334, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 7.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 14.666667, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 35, :voice 0, :duration 1.0, :position 9.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 63, :voice 0, :duration 1.0, :position 10.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 63, :voice 0, :duration 0.16666667, :position 18.5, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 36, :voice 0, :duration 1.0, :position 0.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 75, :voice 0, :duration 1.0, :position 0.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 15.666667, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 50, :voice 0, :duration 1.0, :position 30.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 57, :voice 0, :duration 0.16666667, :position 29.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 5.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 69, :voice 0, :duration 0.16666667, :position 13.833333, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 71, :voice 0, :duration 1.0, :position 9.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 31.833334, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 36, :voice 0, :duration 1.0, :position 24.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 69, :voice 0, :duration 1.0, :position 13.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 24.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 3.6666667, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 70, :voice 0, :duration 0.16666667, :position 11.5, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 12.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 54, :voice 0, :duration 0.16666667, :position 6.1666665, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 30.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 31.666666, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 68, :voice 0, :duration 0.16666667, :position 8.166667, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 72, :voice 0, :duration 1.0, :position 4.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 65, :voice 0, :duration 1.0, :position 1.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 36, :voice 0, :duration 1.0, :position 2.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 30.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 14.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 12.333333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 55, :voice 0, :duration 0.16666667, :position 3.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 4.6666665, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 60, :voice 0, :duration 0.16666667, :position 4.5, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 51, :voice 0, :duration 0.16666667, :position 26.333334, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 60, :voice 0, :duration 1.0, :position 29.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 31, :voice 0, :duration 1.0, :position 14.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 64, :voice 0, :duration 1.0, :position 27.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 15.833333, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 6.6666665, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 23.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 30, :voice 0, :duration 1.0, :position 5.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 59, :voice 0, :duration 0.16666667, :position 15.333333, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 31, :voice 0, :duration 1.0, :position 30.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 53, :voice 0, :duration 1.0, :position 23.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 42, :voice 0, :duration 1.0, :position 13.0, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 36, :voice 0, :duration 1.0, :position 8.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 55, :voice 0, :duration 1.0, :position 6.0, :velocity 42, :track 0} {:patch [nil 32], :channel 0, :pitch 31, :voice 0, :duration 1.0, :position 22.0, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 21.166666, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 55, :voice 0, :duration 1.0, :position 22.0, :velocity 42, :track 0} {:patch [nil 79], :channel 2, :pitch 65, :voice 0, :duration 0.16666667, :position 7.6666665, :velocity 80, :track 0} {:patch [nil 79], :channel 2, :pitch 62, :voice 0, :duration 0.16666667, :position 17.333334, :velocity 80, :track 0} {:patch [nil 32], :channel 0, :pitch 36, :voice 0, :duration 1.0, :position 26.0, :velocity 80, :track 0} {:patch [nil 52], :channel 1, :pitch 75, :voice 0, :duration 1.0, :position 16.0, :velocity 42, :track 0} {:patch [nil 52], :channel 1, :pitch 62, :voice 0, :duration 1.0, :position 6.0, :velocity 42, :track 0}])

             (play-noon multi-chan)))
